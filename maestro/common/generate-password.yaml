# Generates a random password meeting Edge requirements
# Saves the password to the environment variable `output.generatedPassword`
# Accepts an optional `EXCLUDE_UPPER`, `EXCLUDE_LOWER`, and `EXCLUDE_DIGITS` flag to exclude specific character types
# Accepts an optional `PASSWORD_LENGTH` flag to set the length of the password OR random length between 10 and 15

appId: ${MAESTRO_APP_ID}
env:
    PASSWORD_LENGTH: ${PASSWORD_LENGTH || Math.floor(Math.random() * 6) + 10}
---

# Note: Comments not allowed within evalScript
- evalScript: ${
    var upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    var lower = "abcdefghijklmnopqrstuvwxyz";
    var digits = "0123456789";
    var all = "";
    
    if (!EXCLUDE_UPPER) {
      all += upper;
    }
    if (!EXCLUDE_LOWER) {
      all += lower;
    }
    if (!EXCLUDE_DIGITS) {
      all += digits;
    }
    
    var p =
      upper[Math.floor(Math.random()*upper.length)] +
      lower[Math.floor(Math.random()*lower.length)] +
      digits[Math.floor(Math.random()*digits.length)];
    
    while (p.length < PASSWORD_LENGTH) {
      p += all[Math.floor(Math.random()*all.length)];
    }

    p = p
      .split("")
      .sort(() => 0.5 - Math.random())
      .join("");

    output.generatedPassword = p;
    }

# Logging progress
- assertVisible: 
    text: ${"Randomized Password -> " + output.generatedPassword}
    optional: true